{% extends 'menu/basemenu.html' %}
{% load static %}

{% block title %}Dashboard - Citiesoft{% endblock %}

{% block content %}

<!-- MOBILE HEADER -->
<div class="mobile-header">
    <button class="navbar-toggler" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>
    <div class="company-logo-mobile">
        <img src="https://via.placeholder.com/200x60/0066CC/FFFFFF?text=Citiesoft" alt="Citiesoft">
    </div>
</div>

<!-- OVERLAY -->
<div class="overlay" id="overlay"></div>

<!-- SIDEBAR -->
<div class="sidebar">
    <i class="fas fa-bars sidebar-collapsed-icon"></i>

    <div class="sidebar-content">

        <div class="sidebar-header">
            <div class="company-logo">
                <h2 class="company-logo-text">Citiesoft</h2>
            </div>
        </div>

        <div class="user-info">
            <div class="user-avatar">AD</div>
            <div class="user-details">
                <div class="user-name">Administrador</div>
                <div class="user-role">Sistema</div>
            </div>
        </div>

        <div class="sidebar-menu-container">
            <ul class="nav flex-column" id="dynamicMenu">
                <!-- Menu vem do script -->
            </ul>
        </div>

    </div>

    <div class="sidebar-footer">
       <button type="button" class="btn-logout" id="logoutButton" 
            data-login-url="{% url 'login' %}">
        <i class="fas fa-sign-out-alt"></i>
        <span>Sair do Sistema</span>
    </button>
    </div>
</div>

<!-- MAIN CONTENT -->
<div class="main-content">

    <!-- TOP BAR -->
    <div class="top-bar">
        <div class="top-bar-left">
            <div class="top-bar-logo">
                <h2 class="top-bar-logo-text">Citiesoft</h2>
            </div>
        </div>

        <div class="top-bar-status-container">
            <div class="top-bar-status">
                <span class="status-indicator"></span>
                <span>Online</span>
            </div>
        </div>

        <!-- üî• BOT√ÉO DO MODO ESCURO ADICIONADO AQUI -->
        <div class="top-bar-actions">
            <button class="btn-toggle-theme" id="toggleTheme">
                <i class="fa-solid fa-moon"></i>
                <span>Modo Escuro</span>
            </button>
        </div>
    </div>

    <!-- CONTENT HEADER -->
    <div class="content-header">
        <h1><i class="fas fa-tachometer-alt me-2"></i> Painel de Controle</h1>
        <p class="mb-0 mt-2">Vis√£o geral do sistema - <span id="currentDate"></span></p>

        <!-- QUICK ACTIONS -->
        <div class="quick-actions">
            <button class="quick-btn" onclick="window.location.href = '{% url 'cadastrar_ativo' %}'">
                <i class="fas fa-laptop-medical"></i> Novo Ativo
            </button>

            <button class="quick-btn" onclick="window.location.href='{% url 'index2' %}'">
                <i class="fas fa-ticket-alt"></i> Novo Ticket
            </button>

            <button class="quick-btn" onclick="window.location.href = '#link-do-chamado';">
                <i class="fas fa-headset"></i> Novo Chamado
            </button>

            <button class="quick-btn" onclick="window.location.href = '#link-do-relatorio';">
                <i class="fas fa-file-pdf"></i> Relat√≥rio
            </button>
        </div>
    </div>

    <!-- ===== CARDS ===== -->
    {{ block.super }}

    <!-- CARDS DE ESTAT√çSTICAS -->
    <div class="row mb-4">

        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
            <div class="content-card stat-card blue">
                <i class="fas fa-laptop"></i>
                <h3 id="activosCount">0</h3>
                <p>Ativos Totais</p>
            </div>
        </div>

        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
            <div class="content-card stat-card green">
                <i class="fas fa-check-circle"></i>
                <h3 id="ativosAtivosCount">0</h3>
                <p>Ativos Ativos</p>
            </div>
        </div>

        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
            <div class="content-card stat-card red">
                <i class="fas fa-exclamation-triangle"></i>
                <h3 id="ativosManutencaoCount">0</h3>
                <p>Em Manuten√ß√£o</p>
            </div>
        </div>

        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
            <div class="content-card stat-card orange">
                <i class="fas fa-ticket-alt"></i>
                <h3 id="ticketsAbertosCount">0</h3>
                <p>Tickets Abertos</p>
            </div>
        </div>

        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
            <div class="content-card stat-card cyan">
                <i class="fas fa-phone-volume"></i>
                <h3 id="chamadosCount">0</h3>
                <p>Chamados OCS</p>
            </div>
        </div>

        <div class="col-lg-2 col-md-4 col-sm-6 mb-3">
            <div class="content-card stat-card purple">
                <i class="fas fa-users"></i>
                <h3 id="usuariosCount">0</h3>
                <p>Usu√°rios Ativos</p>
            </div>
        </div>
    </div>

    <!-- ===== GR√ÅFICOS ===== -->
    <div class="row">

        <div class="col-lg-3 mb-4">
            <div class="content-card">
                <h5 class="mb-3"><i class="fas fa-chart-pie me-2"></i>Ativos por Status</h5>
                <div class="chart-container" style="height: 280px;">
                    <canvas id="ativosChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-3 mb-4">
            <div class="content-card">
                <h5 class="mb-3"><i class="fas fa-chart-bar me-2"></i>Tickets por Prioridade</h5>
                <div class="chart-container" style="height: 280px;">
                    <canvas id="ticketsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- SISTEMA -->
        <div class="col-lg-3 mb-4">
            <div class="content-card">
                <h5 class="mb-3"><i class="fas fa-server me-2"></i>Status do Sistema/Servidor</h5>

                <div class="system-info-item">
                    <div class="system-info-icon orange">
                        <i class="fas fa-hdd"></i>
                    </div>
                    <div class="system-info-content">
                        <div class="system-info-label">Armazenamento</div>
                        <div class="system-info-value">256 GB / 500 GB</div>
                        <div class="progress-custom mt-2">
                            <div class="progress-bar-custom" style="width: 51%; background: linear-gradient(90deg, #ffc107, #ff9800);"></div>
                        </div>
                    </div>
                </div>

                <div class="system-info-item">
                    <div class="system-info-icon green">
                        <i class="fas fa-microchip"></i>
                    </div>
                    <div class="system-info-content">
                        <div class="system-info-label">CPU</div>
                        <div class="system-info-value">45% em uso</div>
                        <div class="progress-custom mt-2">
                            <div class="progress-bar-custom" style="width: 45%; background: linear-gradient(90deg, #28a745, #20c997);"></div>
                        </div>
                    </div>
                </div>

                <div class="system-info-item">
                    <div class="system-info-icon blue">
                        <i class="fas fa-memory"></i>
                    </div>
                    <div class="system-info-content">
                        <div class="system-info-label">Mem√≥ria RAM</div>
                        <div class="system-info-value">6.2 GB / 16 GB</div>
                        <div class="progress-custom mt-2">
                            <div class="progress-bar-custom" style="width: 38%; background: linear-gradient(90deg, #00A6FF, #0056b3);"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- KPI -->
        <div class="col-lg-3 mb-4">
            <div class="content-card">
                <h5 class="mb-3"><i class="fas fa-chart-line me-2"></i>M√©tricas de KPI</h5>

                <div class="kpi-item">
                    <div class="kpi-header">
                        <span class="kpi-label">Taxa de Resolu√ß√£o</span>
                        <span class="kpi-value success">94.2%</span>
                    </div>
                    <div class="progress-custom mt-2">
                        <div class="progress-bar-custom" style="width: 94.2%; background: linear-gradient(90deg, #28a745, #20c997);"></div>
                    </div>
                </div>

                <div class="kpi-item">
                    <div class="kpi-header">
                        <span class="kpi-label">SLA Cumprido</span>
                        <span class="kpi-value warning">87.5%</span>
                    </div>
                    <div class="progress-custom mt-2">
                        <div class="progress-bar-custom" style="width: 87.5%; background: linear-gradient(90deg, #ffc107, #ff9800);"></div>
                    </div>
                </div>

                <div class="kpi-item">
                    <div class="kpi-header">
                        <span class="kpi-label">Satisfa√ß√£o Cliente</span>
                        <span class="kpi-value success">4.7/5.0</span>
                    </div>
                    <div class="progress-custom mt-2">
                        <div class="progress-bar-custom" style="width: 94%; background: linear-gradient(90deg, #00A6FF, #0056b3);"></div>
                    </div>
                </div>

                <div class="kpi-item">
                    <div class="kpi-header">
                        <span class="kpi-label">Tempo M√©dio Resposta</span>
                        <span class="kpi-value info">2.3h</span>
                    </div>
                    <div class="progress-custom mt-2">
                        <div class="progress-bar-custom" style="width: 76%; background: linear-gradient(90deg, #17a2b8, #138496);"></div>
                    </div>
                </div>

                <div class="kpi-item">
                    <div class="kpi-header">
                        <span class="kpi-label">Uptime do Sistema</span>
                        <span class="kpi-value success">99.8%</span>
                    </div>
                    <div class="progress-custom mt-2">
                        <div class="progress-bar-custom" style="width: 99.8%; background: linear-gradient(90deg, #28a745, #20c997);"></div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- TABELAS -->
    <div class="row">

        <div class="col-lg-8 mb-4">
            <div class="content-card">
                <h5 class="mb-3"><i class="fas fa-history me-2"></i>Tickets Recentes</h5>
                <div class="table-responsive">
                    <table class="activity-table table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√≠tulo</th>
                                <th>Solicitante</th>
                                <th>Prioridade</th>
                                <th>Status</th>
                                <th>Data</th>
                            </tr>
                        </thead>
                        <tbody id="ticketsTable">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- NOTIFICA√á√ïES -->
        <div class="col-lg-4 mb-4">
            <div class="content-card">
                <h5 class="mb-3">
                    <i class="fas fa-bell me-2"></i>Notifica√ß√µes
                    <span class="badge bg-danger ms-2">5</span>
                </h5>
                <div id="notificationsList"></div>
            </div>
        </div>

    </div>

    <!-- ATIVOS RECENTES + OCS -->
    <div class="row">

        <div class="col-lg-6 mb-4">
            <div class="content-card">
                <h5 class="mb-3"><i class="fas fa-laptop me-2"></i>Ativos Recentes</h5>
                <div class="table-responsive">
                    <table class="activity-table table">
                        <thead>
                            <tr>
                                <th>Patrim√¥nio</th>
                                <th>Tipo</th>
                                <th>Departamento</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="ativosTable">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="content-card">
                <h5 class="mb-3"><i class="fas fa-headset me-2"></i>√öltimos Chamados OCS</h5>
                <div class="table-responsive">
                    <table class="activity-table table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Tipo</th>
                                <th>T√©cnico</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="chamadosTable">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

</div>

{% endblock %}
