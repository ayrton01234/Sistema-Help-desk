{% extends 'menu/basemenu.html' %}
{% load static %}

{% block title %}Cadastro de Ativos - Citiesoft{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'menu/css/style_chamados.css' %}">
<link rel="stylesheet" href="{% static 'ativos/css/ativos.css' %}">
{% endblock %}

{% block content %}

<div class="chamados-system">
    <!-- MOBILE HEADER -->
    <div class="mobile-header">
        <button class="navbar-toggler" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        <div class="company-logo-mobile">
            <h2 class="company-logo-text">Citiesoft</h2>
        </div>
    </div>

    <!-- OVERLAY -->
    <div class="overlay" id="overlay"></div>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <i class="fas fa-bars sidebar-collapsed-icon"></i>

        <div class="sidebar-content">
            <div class="sidebar-header">
                <div class="company-logo">
                    <h2 class="company-logo-text">Citiesoft</h2>
                </div>
            </div>

            <div class="user-info">
                <div class="user-avatar">
                    {% if user.first_name %}
                        {{ user.first_name|first }}{{ user.last_name|first }}
                    {% else %}
                        {{ user.username|first|upper }}
                    {% endif %}
                </div>
                <div class="user-details">
                    <div class="user-name">{% if user.get_full_name %}{{ user.get_full_name }}{% else %}{{ user.username }}{% endif %}</div>
                    <div class="user-role">{{ user.groups.first.name|default:"Usuário" }}</div>
                </div>
            </div>

            <div class="sidebar-menu-container">
                <ul class="nav flex-column" id="dynamicMenu">
                    <!-- Menu será carregado via JavaScript -->
                </ul>
            </div>
        </div>

        <div class="sidebar-footer">
            <a href="/admin/logout/" class="btn-logout" id="logoutButton">
                <i class="fas fa-sign-out-alt"></i>
                <span>Sair do Sistema</span>
            </a>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <!-- TOP BAR -->
        <div class="top-bar">
            <div class="top-bar-left">
                <div class="top-bar-logo">
                    <h2 class="top-bar-logo-text">Citiesoft</h2>
                </div>
            </div>
            <div class="top-bar-status-container">
                <div class="top-bar-status">
                    <span class="status-indicator"></span>
                    <span>Online</span>
                </div>
            </div>
        </div>

        <!-- CONTAINER DO FORMULÁRIO -->
        <div class="container">
            <!-- Mensagens do Django -->
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- CARD PRINCIPAL -->
            <div class="form-card">
                <div class="form-header">
                    <i class="fas fa-layer-group"></i>
                    <h1>Cadastrar Novo Ativo</h1>
                </div>

                <form id="formAtivo" method="post">
                    {% csrf_token %}

                    <!-- SEÇÃO 1 — IDENTIFICAÇÃO DO ATIVO -->
                    <div class="form-group">
                        <label class="required">
                            <i class="fas fa-box"></i> Categoria do Ativo
                        </label>
                        <button type="button" class="category-trigger" id="categoryTrigger">
                            <span>Selecione uma categoria...</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <input type="hidden" id="categoria" name="categoria" required>
                    </div>

                    <div class="form-group">
                        <label class="required">
                            <i class="fas fa-tag"></i> Nome do Ativo / Hostname
                        </label>
                        <input type="text" id="nome_ativo" name="nome_ativo" placeholder="Ex: NB-TI-05, SRV-APP-01" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-barcode"></i> Número de Patrimônio
                        </label>
                        <input type="text" id="patrimonio" name="patrimonio" placeholder="Tag de inventário / patrimônio">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-hashtag"></i> Número de Série (Serial)
                        </label>
                        <input type="text" id="numero_serie" name="numero_serie" placeholder="Identificador único do fabricante">
                    </div>

                    <div class="form-group">
                        <label class="required">
                            <i class="fas fa-signal"></i> Status do Ativo
                        </label>
                        <select id="status_ativo" name="status_ativo" required>
                            <option value="">Selecione...</option>
                            <option value="novo">Novo</option>
                            <option value="uso">Em uso</option>
                            <option value="manutencao">Em manutenção</option>
                            <option value="roubado">Roubado / Perdido</option>
                            <option value="descarte">Descarte</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-exclamation-triangle"></i> Criticidade
                        </label>
                        <select id="criticidade" name="criticidade">
                            <option value="">Não informado</option>
                            <option value="baixa">Baixa</option>
                            <option value="media">Média</option>
                            <option value="alta">Alta</option>
                            <option value="critico">Crítico</option>
                        </select>
                    </div>

                    <!-- SEÇÃO 2 — LOCALIZAÇÃO & RESPONSÁVEL -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-map-marker-alt"></i> Localização Física
                        </label>
                        <input type="text" id="localizacao" name="localizacao" placeholder="Ex: Matriz - 2º andar - Sala de TI">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-door-open"></i> Ambiente / Sala / Setor Físico
                        </label>
                        <input type="text" id="ambiente" name="ambiente" placeholder="Ex: Datacenter, Recepção, Almoxarifado">
                    </div>

                    <div class="form-group">
                        <label class="required">
                            <i class="fas fa-user"></i> Usuário Responsável
                        </label>
                        <input type="text" id="usuario_responsavel" name="usuario_responsavel" placeholder="Colaborador responsável pelo ativo" required>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-building"></i> Departamento / Setor
                        </label>
                        <input type="text" id="departamento" name="departamento" placeholder="Ex: Tecnologia da Informação">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-users-cog"></i> Grupo Técnico
                        </label>
                        <select id="grupo_tecnico" name="grupo_tecnico">
                            <option value="">Selecione...</option>
                            <option value="suporte_n1">Suporte N1</option>
                            <option value="suporte_n2">Suporte N2</option>
                            <option value="infra">Infraestrutura</option>
                            <option value="dev">Desenvolvimento</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-phone-alt"></i> Ramal / Contato
                        </label>
                        <input type="text" id="ramal" name="ramal" placeholder="Ramal ou contato local">
                    </div>

                    <!-- SEÇÃO 3 — ESPECIFICAÇÕES TÉCNICAS -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-industry"></i> Fabricante
                        </label>
                        <input type="text" id="fabricante" name="fabricante" placeholder="Ex: Dell, HP, Lenovo, Intelbras...">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-laptop-code"></i> Modelo
                        </label>
                        <input type="text" id="modelo" name="modelo" placeholder="Ex: Latitude 5420, ProLiant DL380...">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-desktop"></i> Sistema Operacional
                        </label>
                        <input type="text" id="sistema_operacional" name="sistema_operacional" placeholder="Ex: Windows 10 Pro, Ubuntu 22.04 LTS...">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-microchip"></i> Processador (CPU)
                        </label>
                        <input type="text" id="cpu" name="cpu" placeholder="Ex: Intel i5 12ª geração, Ryzen 5 5600G...">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-memory"></i> Memória RAM
                        </label>
                        <input type="text" id="ram" name="ram" placeholder="Ex: 8 GB, 16 GB, 32 GB...">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-hdd"></i> Armazenamento
                        </label>
                        <input type="text" id="armazenamento" name="armazenamento" placeholder="Ex: SSD 512 GB, HD 1 TB...">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-network-wired"></i> Endereço IP
                        </label>
                        <input type="text" id="ip" name="ip" placeholder="Ex: 192.168.0.10">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-barcode"></i> MAC Address
                        </label>
                        <input type="text" id="mac" name="mac" placeholder="Ex: AA:BB:CC:DD:EE:FF">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-ethernet"></i> Detalhes de Rede / VLAN / Porta
                        </label>
                        <input type="text" id="detalhes_rede" name="detalhes_rede" placeholder="Ex: VLAN 10 - Porta 23 do SW-CORE-01">
                    </div>

                    <!-- SEÇÃO 4 — INFORMAÇÕES ADMINISTRATIVAS / FINANCEIRAS -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-calendar-plus"></i> Data de Compra
                        </label>
                        <input type="date" id="data_compra" name="data_compra">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-calendar-check"></i> Início da Garantia
                        </label>
                        <input type="date" id="inicio_garantia" name="inicio_garantia">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-calendar-times"></i> Fim da Garantia
                        </label>
                        <input type="date" id="fim_garantia" name="fim_garantia">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-money-bill-wave"></i> Valor de Compra (R$)
                        </label>
                        <input type="text" id="valor_compra" name="valor_compra" placeholder="Ex: 4.500,00">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-store"></i> Fornecedor
                        </label>
                        <input type="text" id="fornecedor" name="fornecedor" placeholder="Fornecedor / Loja / Integrador">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-file-invoice"></i> Número da Nota Fiscal
                        </label>
                        <input type="text" id="nota_fiscal" name="nota_fiscal" placeholder="Número da NF">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-file-contract"></i> Contrato Vinculado
                        </label>
                        <input type="text" id="contrato" name="contrato" placeholder="Nome ou código do contrato de manutenção/locação">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-align-left"></i> Observações Administrativas
                        </label>
                        <textarea id="obs_admin" name="obs_admin" placeholder="Regras de uso, observações de contrato, política de substituição, etc."></textarea>
                    </div>

                    <!-- SEÇÃO 5 — LICENCIAMENTO DE SOFTWARE -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-key"></i> Nome do Software (se aplicável)
                        </label>
                        <input type="text" id="nome_software" name="nome_software" placeholder="Office 365, Antivírus, Sistema interno...">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-key"></i> Chave da Licença / Serial
                        </label>
                        <input type="text" id="chave_licenca" name="chave_licenca" placeholder="Código de ativação / serial">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-id-badge"></i> Tipo de Licença
                        </label>
                        <select id="tipo_licenca" name="tipo_licenca">
                            <option value="">Selecione...</option>
                            <option value="oem">OEM</option>
                            <option value="volume">Volume</option>
                            <option value="assinatura">Assinatura</option>
                            <option value="perpetua">Perpétua</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-users"></i> Quantidade de Instalações Permitidas
                        </label>
                        <input type="number" id="qtd_instalacoes" name="qtd_instalacoes" placeholder="Número máximo de dispositivos permitidos">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-calendar-day"></i> Data de Ativação da Licença
                        </label>
                        <input type="date" id="data_ativacao_licenca" name="data_ativacao_licenca">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-calendar-alt"></i> Data de Expiração da Licença
                        </label>
                        <input type="date" id="data_expiracao_licenca" name="data_expiracao_licenca">
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-info-circle"></i> Observações de Licenciamento
                        </label>
                        <textarea id="obs_licenca" name="obs_licenca" placeholder="Renovação automática, portal de gerenciamento, responsável pelo contrato etc."></textarea>
                    </div>

                    <!-- BOTÕES DE AÇÃO -->
                    <div class="form-actions">
                        <a href="/menu/" class="btn-secondary" id="btnCancelarAtivo">
                            <i class="fas fa-times"></i> Cancelar
                        </a>
                        <button type="button" class="btn-secondary" id="btnLimparAtivo">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                        <button type="submit" class="btn-primary" id="btnSalvarAtivo">
                            <i class="fas fa-save"></i> Salvar Ativo
                        </button>
                    </div>
                </form>
            </div>

            <!-- FOOTER -->
            <div class="footer">
                <p>
                    <i class="fas fa-database"></i>
                    Citiesoft - Módulo de Gestão de Ativos (CMDB)
                </p>
            </div>
        </div>

        <!-- MODAL DE SELEÇÃO DE CATEGORIA -->
        <div class="modal" id="categoryModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>
                        <i class="fas fa-list"></i>
                        Selecione a categoria do ativo
                    </h2>
                    <button class="modal-close" id="modalClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="searchCategory" placeholder="Pesquisar categoria...">
                    </div>

                    <div class="categories-grid">
                        <!-- HARDWARE / ESTAÇÕES -->
                        <div class="category-section">
                            <div class="section-header">
                                <i class="fas fa-desktop"></i> HARDWARE / ESTAÇÕES
                            </div>
                            <ul class="category-list">
                                <li class="category-item" data-category="Computador - Desktop">
                                    <i class="fas fa-desktop"></i>
                                    <span class="category-name">COMPUTADOR DESKTOP</span>
                                </li>
                                <li class="category-item" data-category="Computador - Notebook">
                                    <i class="fas fa-laptop"></i>
                                    <span class="category-name">NOTEBOOK</span>
                                </li>
                                <li class="category-item" data-category="Computador - All-in-One">
                                    <i class="fas fa-display"></i>
                                    <span class="category-name">ALL-IN-ONE</span>
                                </li>
                                <li class="category-item" data-category="Computador - Estação de Trabalho">
                                    <i class="fas fa-microchip"></i>
                                    <span class="category-name">ESTAÇÃO DE TRABALHO</span>
                                </li>
                            </ul>
                        </div>

                        <!-- MONITORES / PERIFÉRICOS -->
                        <div class="category-section">
                            <div class="section-header">
                                <i class="fas fa-tv"></i> MONITORES E PERIFÉRICOS
                            </div>
                            <ul class="category-list">
                                <li class="category-item" data-category="Monitor - Padrão">
                                    <i class="fas fa-tv"></i>
                                    <span class="category-name">MONITOR</span>
                                </li>
                                <li class="category-item" data-category="Monitor - Ultrawide">
                                    <i class="fas fa-tv"></i>
                                    <span class="category-name">MONITOR ULTRAWIDE</span>
                                </li>
                                <li class="category-item" data-category="Periférico - Teclado">
                                    <i class="fas fa-keyboard"></i>
                                    <span class="category-name">TECLADO</span>
                                </li>
                                <li class="category-item" data-category="Periférico - Mouse">
                                    <i class="fas fa-mouse"></i>
                                    <span class="category-name">MOUSE</span>
                                </li>
                                <li class="category-item" data-category="Periférico - Headset">
                                    <i class="fas fa-headphones"></i>
                                    <span class="category-name">HEADSET</span>
                                </li>
                            </ul>
                        </div>

                        <!-- IMPRESSORAS -->
                        <div class="category-section">
                            <div class="section-header">
                                <i class="fas fa-print"></i> IMPRESSÃO
                            </div>
                            <ul class="category-list">
                                <li class="category-item" data-category="Impressora - Jato de Tinta">
                                    <i class="fas fa-print"></i>
                                    <span class="category-name">IMPRESSORA JATO DE TINTA</span>
                                </li>
                                <li class="category-item" data-category="Impressora - Laser">
                                    <i class="fas fa-print"></i>
                                    <span class="category-name">IMPRESSORA LASER</span>
                                </li>
                                <li class="category-item" data-category="Impressora - Multifuncional">
                                    <i class="fas fa-print"></i>
                                    <span class="category-name">MULTIFUNCIONAL</span>
                                </li>
                            </ul>
                        </div>

                        <!-- REDE -->
                        <div class="category-section">
                            <div class="section-header">
                                <i class="fas fa-network-wired"></i> REDE
                            </div>
                            <ul class="category-list">
                                <li class="category-item" data-category="Rede - Switch">
                                    <i class="fas fa-network-wired"></i>
                                    <span class="category-name">SWITCH</span>
                                </li>
                                <li class="category-item" data-category="Rede - Roteador">
                                    <i class="fas fa-route"></i>
                                    <span class="category-name">ROTEADOR</span>
                                </li>
                                <li class="category-item" data-category="Rede - Access Point">
                                    <i class="fas fa-wifi"></i>
                                    <span class="category-name">ACCESS POINT</span>
                                </li>
                                <li class="category-item" data-category="Rede - Firewall">
                                    <i class="fas fa-shield-alt"></i>
                                    <span class="category-name">FIREWALL</span>
                                </li>
                            </ul>
                        </div>

                        <!-- SERVIDORES -->
                        <div class="category-section">
                            <div class="section-header">
                                <i class="fas fa-server"></i> SERVIDORES
                            </div>
                            <ul class="category-list">
                                <li class="category-item" data-category="Servidor - Físico">
                                    <i class="fas fa-server"></i>
                                    <span class="category-name">SERVIDOR FÍSICO</span>
                                </li>
                                <li class="category-item" data-category="Servidor - Virtual">
                                    <i class="fas fa-cloud"></i>
                                    <span class="category-name">SERVIDOR VIRTUAL</span>
                                </li>
                            </ul>
                        </div>

                        <!-- SOFTWARE -->
                        <div class="category-section">
                            <div class="section-header">
                                <i class="fas fa-code"></i> SOFTWARE / LICENÇAS
                            </div>
                            <ul class="category-list">
                                <li class="category-item" data-category="Software - Office">
                                    <i class="fas fa-file-word"></i>
                                    <span class="category-name">OFFICE / PRODUTIVIDADE</span>
                                </li>
                                <li class="category-item" data-category="Software - Antivírus">
                                    <i class="fas fa-shield-virus"></i>
                                    <span class="category-name">ANTIVÍRUS</span>
                                </li>
                                <li class="category-item" data-category="Software - Sistema Interno">
                                    <i class="fas fa-database"></i>
                                    <span class="category-name">SISTEMAS INTERNOS / ERP</span>
                                </li>
                            </ul>
                        </div>

                        <!-- SEGURANÇA -->
                        <div class="category-section">
                            <div class="section-header">
                                <i class="fas fa-shield-alt"></i> SEGURANÇA / CFTV
                            </div>
                            <ul class="category-list">
                                <li class="category-item" data-category="Segurança - Câmera IP">
                                    <i class="fas fa-video"></i>
                                    <span class="category-name">CÂMERA IP</span>
                                </li>
                                <li class="category-item" data-category="Segurança - DVR/NVR">
                                    <i class="fas fa-hard-drive"></i>
                                    <span class="category-name">DVR / NVR</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" id="modalCancel">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-primary" id="modalConfirm">
                        <i class="fas fa-check"></i> Selecionar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'menu/js/script_chamados.js' %}"></script>
<script src="{% static 'ativos/js/ativos.js' %}"></script>
{% endblock %}