{% extends 'menu/cliente/template_cliente.html' %}
{% load static %}

{% block title %}Meus Chamados - Portal do Cliente{% endblock %}

{% block page_header %}
<h1><i class="fas fa-ticket-alt"></i> Meus Chamados</h1>
<p>Acompanhe o status dos seus chamados - <span id="currentDate"></span></p>
{% endblock %}

{% block extra_css %}
<link href="{% static 'menu/css/meus_chamados.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- Filtros por Status -->
<div class="filter-tabs">
    <div class="filter-tab active" data-filter="todos">
        <i class="fas fa-list"></i>
        Todos
    </div>
    <div class="filter-tab" data-filter="aberto">
        <i class="fas fa-hourglass-half"></i>
        Abertos / Em Andamento
    </div>
    <div class="filter-tab" data-filter="aguardando">
        <i class="fas fa-exclamation-circle"></i>
        Aguardando Resposta
    </div>
    <div class="filter-tab" data-filter="resolvido">
        <i class="fas fa-check-circle"></i>
        Resolvidos / Fechados
    </div>
</div>

<div class="card-chamados">
    <div class="card-chamados-header">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Buscar por ID, título ou descrição...">
            <i class="fas fa-search"></i>
        </div>
        <button class="btn-novo-chamado" onclick="window.location.href='{% url 'abrir_chamado_cliente' %}'">
            <i class="fas fa-plus-circle"></i>
            Novo Chamado
        </button>
    </div>

    <div class="table-responsive">
        <table class="table-chamados" id="tableChamados">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Título</th>
                    <th>Status</th>
                    <th>Prioridade</th>
                    <th>Categoria</th>
                    <th>Data Abertura</th>
                    <th>Última Atualização</th>
                    <th>Ações</th>
                </tr>
            </thead>

            <tbody id="chamadosTableBody">
            {% if tickets %}
                {% for ticket in tickets %}
                <tr data-status="{{ ticket.status }}">
                    <td>
                        <span class="chamado-id">#{{ ticket.id }}</span>
                    </td>

                    <td>
                        <strong>{{ ticket.assunto }}</strong>
                    </td>

                    <td>
                        <span class="status-badge status-{{ ticket.status }}">
                            {{ ticket.get_status_display }}
                        </span>
                    </td>

                    <td>
                        <span class="prioridade-badge prioridade-{{ ticket.prioridade }}">
                            {{ ticket.get_prioridade_display }}
                        </span>
                    </td>

                    <td>
                        {{ ticket.categoria }}
                    </td>

                    <td>
                        {{ ticket.criado_em|date:"d/m/Y" }}
                    </td>

                    <td>
                        {{ ticket.atualizado_em|date:"d/m/Y H:i" }}
                    </td>

                    <td>
                        <a href="#" class="btn-action btn-view">
                            <i class="fas fa-eye"></i> Ver
                        </a>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="8" style="text-align:center; padding:30px;">
                        Nenhum chamado encontrado.
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'menu/js/meus_chamados.js' %}"></script>
{% endblock %}
