{% extends 'menu/cliente/template_cliente.html' %}
{% load static %}

{% block title %}Abrir Novo Chamado - Portal do Cliente{% endblock %}

{% block extra_css %}
<link href="{% static 'menu/css/abrir_chamado_cliente.css' %}" rel="stylesheet">
{% endblock %}

{% block page_header %}
<h1><i class="fas fa-plus-circle"></i> Abrir Novo Chamado</h1>
<p>Descreva seu problema ou solicita√ß√£o - Nossa equipe responder√° em breve</p>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-card">
        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="step active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Informa√ß√µes B√°sicas</div>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Detalhes</div>
            </div>
            <div class="step-line"></div>
            <div class="step" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Revis√£o</div>
            </div>
        </div>

        <!-- Form Content Wrapper com Scroll -->
        <div class="form-content-wrapper">
            <form id="ticketForm" method="POST" enctype="multipart/form-data" action="{% url 'abrir_chamado_cliente' %}">
                {% csrf_token %}
                
                <!-- Step 1: Informa√ß√µes B√°sicas -->
                <div class="form-step active" data-step="1">
                    <h3 class="step-title">
                        <i class="fas fa-info-circle"></i> Informa√ß√µes B√°sicas
                    </h3>

                    <div class="form-group">
                        <label for="assunto" class="form-label">
                            <i class="fas fa-heading"></i> Assunto do Chamado
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="assunto" 
                            name="assunto" 
                            placeholder="Ex: Erro ao acessar o sistema" 
                            required
                            maxlength="200"
                        >
                        <small class="form-text">Seja claro e objetivo no t√≠tulo</small>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="area" class="form-label">
                                    <i class="fas fa-layer-group"></i> √Årea
                                    <span class="required">*</span>
                                </label>
                                <select class="form-control" id="area" name="area" required>
                                    <option value="">Selecione a √°rea</option>
                                    <option value="hardware">Hardware</option>
                                    <option value="software">Software</option>
                                    <option value="rede">Rede / Infraestrutura</option>
                                    <option value="desenvolvimento">Desenvolvimento</option>
                                    <option value="banco_dados">Banco de Dados</option>
                                    <option value="suporte_usuario">Suporte ao Usu√°rio</option>
                                    <option value="seguranca">Seguran√ßa da Informa√ß√£o</option>
                                    <option value="outro">Outro</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="categoria" class="form-label">
                                    <i class="fas fa-folder"></i> Categoria
                                    <span class="required">*</span>
                                </label>
                                <select class="form-control" id="categoria" name="categoria" required disabled>
                                    <option value="">Selecione a √°rea primeiro</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="prioridade" class="form-label">
                            <i class="fas fa-exclamation-triangle"></i> Prioridade
                            <span class="required">*</span>
                        </label>
                        <select class="form-control" id="prioridade" name="prioridade" required>
                            <option value="">Selecione a prioridade</option>
                            <option value="1">üü¢ Baixa - N√£o √© urgente</option>
                            <option value="2">üü° M√©dia - Importante</option>
                            <option value="3">üü† Alta - Urgente</option>
                            <option value="4">üî¥ Cr√≠tica - Sistema parado</option>
                        </select>

                        <small class="form-text">Avalie o impacto no seu trabalho</small>
                    </div>
                </div>

                <!-- Step 2: Detalhes -->
                <div class="form-step" data-step="2">
                    <h3 class="step-title">
                        <i class="fas fa-align-left"></i> Detalhes do Problema
                    </h3>

                    <div class="form-group">
                        <label for="descricao" class="form-label">
                            <i class="fas fa-file-alt"></i> Descri√ß√£o Completa
                            <span class="required">*</span>
                        </label>
                        <textarea 
                            class="form-control" 
                            id="descricao" 
                            name="descricao" 
                            rows="6"
                            placeholder="Descreva detalhadamente o problema ou solicita√ß√£o...&#10;&#10;‚Ä¢ O que aconteceu?&#10;‚Ä¢ Quando come√ßou?&#10;‚Ä¢ Qual era o resultado esperado?"
                            required
                            maxlength="2000"
                        ></textarea>
                        <div class="char-counter">
                            <span id="charCount">0</span> / 2000 caracteres
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="anexos" class="form-label">
                            <i class="fas fa-paperclip"></i> Anexar Arquivos (Opcional)
                        </label>
                        <div class="file-upload-area" id="fileUploadArea">
                            <input 
                                type="file" 
                                class="form-control-file" 
                                id="anexos" 
                                name="anexos" 
                                multiple
                                accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.jpg,.jpeg,.png,.gif"
                            >
                            <div class="upload-placeholder">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Clique para selecionar ou arraste arquivos aqui</p>
                                <small>PDF, DOC, XLS, TXT, Imagens (M√°x: 10MB por arquivo)</small>
                            </div>
                            <div class="file-list" id="fileList"></div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Revis√£o -->
                <div class="form-step" data-step="3">
                    <h3 class="step-title">
                        <i class="fas fa-check-circle"></i> Revis√£o do Chamado
                    </h3>

                    <div class="review-section">
                        <div class="review-item">
                            <div class="review-label">
                                <i class="fas fa-heading"></i> Assunto:
                            </div>
                            <div class="review-value" id="review-assunto">-</div>
                        </div>

                        <div class="review-item">
                            <div class="review-label">
                                <i class="fas fa-layer-group"></i> √Årea:
                            </div>
                            <div class="review-value" id="review-area">-</div>
                        </div>

                        <div class="review-item">
                            <div class="review-label">
                                <i class="fas fa-folder"></i> Categoria:
                            </div>
                            <div class="review-value" id="review-categoria">-</div>
                        </div>

                        <div class="review-item">
                            <div class="review-label">
                                <i class="fas fa-exclamation-triangle"></i> Prioridade:
                            </div>
                            <div class="review-value" id="review-prioridade">-</div>
                        </div>

                        <div class="review-item">
                            <div class="review-label">
                                <i class="fas fa-file-alt"></i> Descri√ß√£o:
                            </div>
                            <div class="review-value" id="review-descricao">-</div>
                        </div>

                        <div class="review-item" id="review-anexos-container" style="display: none;">
                            <div class="review-label">
                                <i class="fas fa-paperclip"></i> Anexos:
                            </div>
                            <div class="review-value" id="review-anexos">-</div>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        <strong>Aten√ß√£o:</strong> Ap√≥s enviar o chamado, voc√™ receber√° um n√∫mero de protocolo e poder√° acompanhar o andamento na se√ß√£o "Meus Chamados".
                    </div>
                </div>
            </form>
        </div>

        <!-- Form Navigation (fixo na parte inferior) -->
        <div class="form-navigation">
            <button type="button" class="btn btn-prev" data-prev="1" style="display: none;">
                <i class="fas fa-arrow-left"></i> Voltar
            </button>
            <button type="button" class="btn btn-next" data-next="2">
                Pr√≥ximo <i class="fas fa-arrow-right"></i>
            </button>
            <button type="button" class="btn btn-submit" style="display: none;">
                <i class="fas fa-paper-plane"></i> Enviar Chamado
            </button>
        </div>
    </div>

    <!-- Tips Card -->
    <div class="tips-card">
        <h4><i class="fas fa-lightbulb"></i> Dicas para um Atendimento R√°pido</h4>
        <ul>
            <li><i class="fas fa-check"></i> Seja espec√≠fico no t√≠tulo do chamado</li>
            <li><i class="fas fa-check"></i> Selecione a √°rea e categoria corretas</li>
            <li><i class="fas fa-check"></i> Descreva detalhadamente o problema</li>
            <li><i class="fas fa-check"></i> Anexe prints ou documentos relevantes</li>
            <li><i class="fas fa-check"></i> Informe quando o problema come√ßou</li>
            <li><i class="fas fa-check"></i> Mencione se afeta outros usu√°rios</li>
        </ul>

        <div class="contact-info">
            <h5><i class="fas fa-headset"></i> Suporte Urgente?</h5>
            <p>Para problemas cr√≠ticos, entre em contato:</p>
            <a href="tel:+559833333333" class="contact-link">
                <i class="fas fa-phone"></i> (98) 3333-3333
            </a>
            <a href="https://wa.me/5598988888888" class="contact-link">
                <i class="fab fa-whatsapp"></i> (98) 98888-8888
            </a>
        </div>
    </div>
</div>

<!-- Modal de Sucesso -->
<div class="modal fade" id="successModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Chamado Aberto com Sucesso!</h3>
                <p class="ticket-number">Protocolo: <strong>#<span id="protocolNumber"></span></strong></p>
                <p>Voc√™ receber√° atualiza√ß√µes por e-mail e poder√° acompanhar o chamado na se√ß√£o "Meus Chamados".</p>
                <div class="modal-actions">
                    <a href="{% url 'meus_chamados' %}" class="btn btn-next" style="margin: 0;">
                        <i class="fas fa-list"></i> Ver Meus Chamados
                    </a>
                    <a href="{% url 'template_cliente' %}" class="btn btn-prev" style="margin: 0;">
                        <i class="fas fa-home"></i> Voltar ao Dashboard
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'menu/js/abrir_chamado_cliente.js' %}"></script>
{% endblock %}