{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}P√°gina - Citiesoft{% endblock %}</title>
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'menu/img/favico.ico' %}">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link href="{% static 'menu/css/template_citiesoft.css' %}" rel="stylesheet">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <script>
        // URLs do Django
        window.DjangoURLs = {
            citiesoft_home: '{% url "citiesoft_home" %}',
            abrir_chamado: '{% url "abrir_chamado" %}',
            cadastro_ativo: '{% url "cadastro_ativo" %}',
            cadastro_contrato: '{% url "cadastro_contrato" %}',
            relatorios_atendimento: '{% url "relatorios_atendimento" %}',
            relatorio_ativos: '{% url "relatorio_ativos" %}',
            metricas_kpi: '{% url "metricas_kpi" %}',
            pessoas_ativas: '{% url "pessoas_ativas" %}',
            register: '{% url "register" %}',
            atribuicao_tickets: '{% url "atribuicao_tickets" %}',
            autorizacao_usuarios: '{% url "autorizacao_usuarios" %}',
            admin_base_conhecimento: '{% url "admin_base_conhecimento" %}',
            cadastro_usuario: '{% url "cadastro_usuario" %}',
            meus_tickets: '{% url "meus_tickets" %}',
            
            // URLs Portal do Cliente
            template_cliente: '{% url "citiesoft_home" %}',
            abrir_chamado_cliente: '{% url "abrir_chamado" %}',
            meus_chamados: '{% url "citiesoft_home" %}',
            base_conhecimento: '{% url "admin_base_conhecimento" %}'
        };

        // üõ°Ô∏è VERIFICA√á√ÉO DE USU√ÅRIO (A ponte que voc√™ precisava)
        window.is_admin = {% if user.is_superuser %} true {% else %} false {% endif %};

        console.log('‚úÖ Sistema carregado para:', window.is_admin ? 'ADMIN' : 'FUNCION√ÅRIO');
    </script>

    <div class="mobile-header">
        <button class="navbar-toggler" id="sidebarToggle">
            <i class="fas fa-bars"></i>
        </button>
        <div class="company-logo-mobile">
            <h2>Citiesoft</h2>
        </div>
    </div>

    <div class="overlay" id="overlay"></div>

    <div class="sidebar" id="sidebar">
        <i class="fas fa-bars sidebar-collapsed-icon"></i>
        
        <div class="sidebar-content">
            <div class="sidebar-header">
                <div class="company-logo">
                    <h2 class="company-logo-text">Citiesoft</h2>
                </div>
            </div>

            <div class="user-info">
                <div class="user-avatar">{{ user.first_name|first|upper }}</div>
                <div class="user-details">
                    <div class="user-name">{{ user.first_name }} {{ user.last_name }}</div>
                    <div class="user-role">{% if user.is_superuser %}Administrador{% else %}Funcion√°rio{% endif %}</div>
                </div>
            </div>

            <div class="sidebar-menu-container">
                <ul class="nav flex-column" id="dynamicMenu"></ul>
            </div>
        </div>

        <div class="sidebar-footer">
            <form method="POST" action="{% url 'logout' %}" style="width: 100%;">
                {% csrf_token %}
                <button type="submit" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sair do Sistema</span>
                </button>
            </form>
        </div>
    </div>

    <div class="top-bar">
        <div class="top-bar-left">
            <div class="top-bar-logo">
                <h2 class="top-bar-logo-text">Citiesoft</h2>
            </div>
        </div>

        <div class="top-bar-status-container">
            <div class="top-bar-status">
                <span class="status-indicator"></span>
                <span>Online</span>
            </div>
            <button class="btn-toggle-theme" id="toggleTheme">
                <i class="fa-solid fa-moon"></i>
                <span>Modo Escuro</span>
            </button>
        </div>
    </div>

    <div class="main-content">
        <div class="content-header">
            {% block page_header %}
            <h1><i class="fas fa-desktop"></i> Painel de Controle</h1>
            <p>Bem-vindo ao Citiesoft - <span id="currentDate"></span></p>
            {% endblock %}
        </div>

        {% if user.is_superuser %}
        <div class="alert alert-warning border-start border-4 border-warning shadow-sm mb-4">
            <h5><i class="fas fa-user-shield"></i> Painel Administrativo Ativo</h5>
            <p class="mb-0">Este campo de configura√ß√£o √© <strong>exclusivo</strong> e funcion√°rios n√£o podem v√™-lo.</p>
        </div>
        {% endif %}

        {% block content %}
        {% endblock %}

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'menu/js/template_citiesoft.js' %}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>